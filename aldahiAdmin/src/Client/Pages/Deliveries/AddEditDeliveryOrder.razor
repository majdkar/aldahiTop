@page "/order-details/{OrderId:int}"
@using FirstCall.Shared.Constants.Clients
@using FirstCall.Shared.Constants.Orders
@inject Microsoft.Extensions.Localization.IStringLocalizer<AddEditDeliveryOrder> _localizer

<MudContainer MaxWidth="@MaxWidth.Large" Class="mt-6">
    <MudPaper Class="p-6" Elevation="2" Style="background-color:#fafafa; border-radius:16px;">
        <EditForm Model="@AddEditDeliveryOrderModel" OnValidSubmit="SaveAsync">
            <FluentValidationValidator @ref="_fluentValidationValidator" />

            <!-- Basic Info Panel -->
            <MudExpansionPanel IsExpanded="true" Text=@_localizer["Basic Information"] Dense="true">
                <MudGrid Spacing="3">
                    
                
                    <!-- Order Information -->
                    <MudItem xs="12">
                        <MudCard Elevation="2" Class="p-3">
                            <MudCardHeader>
                                <MudAvatar Color="Color.Info" Size="Size.Medium" Class="mr-2">
                                    <MudIcon Icon="@Icons.Outlined.ReceiptLong" />
                                </MudAvatar>
                                <MudText Typo="Typo.h6">@_localizer["OrderInformation"]</MudText>
                            </MudCardHeader>
                            <MudDivider />
                            <MudCardContent>
                                <MudGrid Spacing="3">
                                    <MudItem xs="12" md="6">
                                        @if (_persons != null)
                                        {
                                            <MudSelect @bind-Value="@AddEditDeliveryOrderModel.ClientId" T="int" Label="@_localizer["Persons"]" Variant="Variant.Outlined" >
                                                @foreach (var value in _persons)
                                                {
                                                    <MudSelectItem T="int" Value="@value.ClientId">
                                                        @value.FullName
                                                    </MudSelectItem>
                                                }
                                            </MudSelect>
                                        }
                                    </MudItem>
                                    <MudItem xs="12" md="6">
                                        <MudDatePicker @bind-Date="AddEditDeliveryOrderModel.OrderDate"
                                                       Culture="System.Globalization.CultureInfo.InvariantCulture"
                                                       Label="@_localizer["Order Date"]"
                                                       DisableToolbar="true"
                                                       AutoClose="true"
                                                       InputVariant="Variant.Outlined"
                                                        />
                                    </MudItem>


                                    @if (AddEditDeliveryOrderModel.Id != 0)
                                    {
                                        <MudItem xs="12" md="6">
                                            <MudTextField For="@(() => AddEditDeliveryOrderModel.OrderNumber)"
                                                          @bind-Value="AddEditDeliveryOrderModel.OrderNumber"
                                                          Label="@_localizer["OrderNumber"]"
                                                          Variant="Variant.Outlined"
                                                          ReadOnly Dense="true" FullWidth />
                                        </MudItem>

                                        <MudItem xs="12" md="6">
                                            <MudSelect @bind-Value="@AddEditDeliveryOrderModel.Status"
                                                       T="string"
                                                       Label="@_localizer["Status"]"
                                                       Variant="Variant.Outlined"
                                                       Dense="true" FullWidth>
                                                @foreach (var value in OrderStatus.Values)
                                                {
                                                    <MudSelectItem T="string" Value="@value.Key">@_localizer[@value.Value]</MudSelectItem>
                                                }
                                            </MudSelect>
                                        </MudItem>
                                    }
                                </MudGrid>
                            </MudCardContent>
                        </MudCard>
                    </MudItem>

                    <!-- Products -->
                    <MudItem xs="12">
                        <InsideDeliveryOrdersProducts OrderId="@OrderId" @bind-Charges="AddEditDeliveryOrderModel.ChargesCommand" @ref="_leaseCharges" />
                    </MudItem>

                </MudGrid>
            </MudExpansionPanel>

            <!-- Actions -->
            <MudDivider Class="my-4" />
               
            
            <MudCardActions Class="d-flex justify-end flex-grow-1 gap-4 mr-2">
            <MudButton DisableElevation Variant="Variant.Outlined" Color="Color.Error" OnClick="@(() => _navigationManager.NavigateTo("/HomeDeliveryOrders"))">
                    @_localizer["Cancel"]
                </MudButton>
              
                
                
                @if (AddEditDeliveryOrderModel.Id != 0)
                {
                    <LoadingButton IsProcessing="@_isProcessing"
                                   ButtonText="@_localizer["Update"]"
                                   Disabled="@(!Validated)"
                                   Variant="Variant.Filled"
                                   ButtonType="ButtonType.Submit"
                                   Color="Color.Secondary" />
                }
                else
                {
                    <LoadingButton IsProcessing="@_isProcessing"
                                   ButtonText="@_localizer["Save"]"
                                   Disabled="@(!Validated)"
                                   Variant="Variant.Filled"
                                   ButtonType="ButtonType.Submit"
                                   Color="Color.Success" />
                }
                </MudCardActions>
        </EditForm>
    </MudPaper>
</MudContainer>
