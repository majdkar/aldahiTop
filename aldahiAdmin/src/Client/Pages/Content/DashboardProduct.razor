@page "/dashboardProduct"
@attribute [Authorize(Policy = Permissions.Dashboards.View)]
@inject Microsoft.Extensions.Localization.IStringLocalizer<Dashboard> _localizer


    <style>
    .mud-card-content {
        padding-top: 16px !important;
        padding-right: 16px !important;
        padding-left: 16px !important;
        padding-bottom: 0px !important;
    }

    .sp img {
        object-fit: cover;
        width: 100%;
        height: 330px;
    }
    </style>

      

<MudContainer MaxWidth="MaxWidth.ExtraLarge" Class="mt-4">
   
    
    
    <MudGrid Spacing="2" Class="mb-4">
    <MudItem>
        <MudCheckBox @bind-Checked="@selectedTypesDict["B2B"]" Label="@_localizer["B2B"]" Color="Color.Primary" />
    </MudItem>
    <MudItem>
            <MudCheckBox @bind-Checked="@selectedTypesDict["B2C"]" Label="@_localizer["B2C"]" Color="Color.Secondary" />
    </MudItem>
    </MudGrid>


    <MudGrid Spacing="2" Class="mb-4">
        <MudItem>
            <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="@(() => FilterByKind("ب ب"))">
                @_localizer["B B"]
            </MudButton>
        </MudItem>
        <MudItem>
            <MudButton Variant="Variant.Filled" Color="Color.Secondary" OnClick="@(() => FilterByKind("وسط"))">
                @_localizer["Midlle"]
            </MudButton>
        </MudItem>
        <MudItem>
            <MudButton Variant="Variant.Filled" Color="Color.Tertiary" OnClick="@(() => FilterByKind("محير"))">
                @_localizer["Moher"]
            </MudButton>
        </MudItem>
        <MudItem>
            <MudButton Variant="Variant.Outlined" Color="Color.Default" OnClick="@(() => FilterByKind(null))">
                @_localizer["All"]
            </MudButton>
        </MudItem>
    </MudGrid>

    <!-- ✅ مربع البحث بالكود -->
    <MudGrid Class="mb-4">
        <MudItem xs="12" sm="6">
            <MudTextField @bind-Value="searchCode" Label="Search by Code" Variant="Variant.Outlined" FullWidth="true" />
        </MudItem>
        <MudItem xs="12" sm="6" Class="d-flex align-items-center">
            <MudSwitch @bind-Checked="isExactMatch" Color="Color.Primary" />
            <MudText Class="ml-2">
                @(isExactMatch ? "Exact Match" : "Partial Match")
            </MudText>
        </MudItem>
    </MudGrid>


    @if (filteredProducts is not null)
    {
    <MudGrid Spacing="3">
            <MudVirtualize Items="@filteredProducts" Context="item">
                    @if (item != null)
                    {
                        <MudItem xs="12" sm="6" md="4" lg="3">
                            <MudCard Class="pt-3 ma-2" Style="height:490px; display:flex; flex-direction:column;">
                            <MudCardMedia Class="ml-2 mr-2 rounded-lg sp" onclick="@(() => OpenImageDialog(item.ImageProduct))" Image="@(item.ImageProduct.Replace('\\', '/'))" Height="300" />
                                <MudCardContent Style="flex:1;">
                                <MudText Typo="Typo.h6">@(IsArabic ? item.CategoryName : item.CategoryNameEn)</MudText>
                            <MudText Typo="Typo.body2" Color="Color.Secondary">
                                    @(IsArabic ? item.KindName : item.KindNameEn) / @(IsArabic ? item.GroupName : item.GroupNameEn) / @_localizer["Model"] > <p style="color:blue;display: inline-block;"><strong><b>@item.Code</b> </strong></p>
                            </MudText>

                            <MudDivider Class="my-2" />

                            <MudText Typo="Typo.h3" Color="Color.Primary" Class="fw-bold">
                                @item.Qty
                            </MudText>
                    
                        </MudCardContent>
                            <MudCardActions>
                                <MudButton Variant="Variant.Filled" Color="Color.Primary" Size="Size.Small" Link="@($"/product-details/{item.Id}")">
                                    @_localizer["Details"]
                                </MudButton>
                            </MudCardActions>
                    </MudCard>
                </MudItem>
                }
        </MudVirtualize>
        </MudGrid>
      
    }
    else
    {
        <MudProgressCircular Color="Color.Primary" Indeterminate="true" />
    }
</MudContainer>
